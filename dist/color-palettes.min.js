!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ColorPalettes",[],e):"object"==typeof exports?exports.ColorPalettes=e():t.ColorPalettes=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return t[o].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=n(1),a=o(u),s=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},f=function(t){for(var e="",n=0;n<3;n++)e+=s(t[n]);return e},c=function(){function t(e){var n=this;r(this,t),e instanceof HTMLImageElement?(this._image=e,this.fetching=new Promise(function(t){t()})):"string"==typeof e&&(this._imageUrl=e,this.fetching=new Promise(function(t,e){n._fetchImage(t,e)}))}return i(t,[{key:"_fetchImage",value:function(t,e){this._image=new Image,this._image.crossOrigin="anonymous",this._image.src=this._imageUrl,this._image.onload=function(){t()}}},{key:"_getPixelArray",value:function(){return this._getCanvas().getContext("2d").getImageData(0,0,this._image.width,this._image.height).data}},{key:"_getCanvas",value:function(){if(this._canvas)return this._canvas;var t=void 0;return this._canvas=document.createElement("canvas"),this._canvas.width=this._image.width,this._canvas.height=this._image.height,t=this._canvas.getContext("2d"),t.drawImage(this._image,0,0),this._canvas}},{key:"dominantThree",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.format,n=void 0===e?"rgb":e;return this.getPalettes({colorCount:5,format:n}).then(function(t){return t.slice(0,3)})}},{key:"getPalettes",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=e.colorCount,o=void 0===n?10:n,r=e.format,i=void 0===r?"rgb":r;return this.fetching.then(function(e){for(var n,r,u,s=t._getPixelArray(),c=t._image.width*t._image.height,h=[],v=0;v<c;v+=4)n=s[v+0],r=s[v+1],u=s[v+2],h.push([n,r,u]);var l=(0,a["default"])(h,o),d=l.palette();if("hex"===i){var g=d.map(function(t){return f(t)});return g}return d})}}]),t}();e["default"]=c,t.exports=e["default"]},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=n(2),a=o(u),s=5,f=8-s,c=1e3,h=.75,v=function(t,e,n){return(t<<2*s)+(e<<s)+n},l=function(t){var e=[],n=!1,o=function(){e.sort(t),n=!0};return{push:function(t){e.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return n||o(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return n||o(),e}}},d=function(t){var e=1<<3*s,n=new Array(e),o=void 0,r=void 0,i=void 0,u=void 0;return t.forEach(function(t){r=t[0]>>f,i=t[1]>>f,u=t[2]>>f,o=v(r,i,u),n[o]=(n[o]||0)+1}),n},g=function(t,e){var n=1e6,o=0,r=1e6,i=0,u=1e6,a=0,s=void 0,c=void 0,h=void 0;return t.forEach(function(t){s=t[0]>>f,c=t[1]>>f,h=t[2]>>f,s<n?n=s:s>o&&(o=s),c<r?r=c:c>i&&(i=c),h<u?u=h:h>a&&(a=h)}),new b(n,o,r,i,u,a,e)},p=function(t,e){function n(t){var n=t+"1",o=t+"2",r=void 0,i=void 0,u=void 0,h=void 0,v=void 0,l=0;for(c=e[n];c<=e[o];c++)if(s[c]>a/2){for(u=e.copy(),h=e.copy(),r=c-e[n],i=e[o]-c,v=r<=i?Math.min(e[o]-1,~~(c+i/2)):Math.max(e[n],~~(c-1-r/2));!s[v];)v++;for(l=f[v];!l&&s[v-1];)l=f[--v];return u[o]=v,h[n]=u[o]+1,[u,h]}}if(e.count()){var o=e.r2-e.r1+1,r=e.g2-e.g1+1,i=e.b2-e.b1+1,u=Math.max.apply(Math,[o,r,i]);if(1==e.count())return[e.copy()];var a=0,s=[],f=[],c=void 0,h=void 0,l=void 0,d=void 0,g=void 0;if(u==o)for(c=e.r1;c<=e.r2;c++){for(d=0,h=e.g1;h<=e.g2;h++)for(l=e.b1;l<=e.b2;l++)g=v(c,h,l),d+=t[g]||0;a+=d,s[c]=a}else if(u==r)for(c=e.g1;c<=e.g2;c++){for(d=0,h=e.r1;h<=e.r2;h++)for(l=e.b1;l<=e.b2;l++)g=v(h,c,l),d+=t[g]||0;a+=d,s[c]=a}else for(c=e.b1;c<=e.b2;c++){for(d=0,h=e.r1;h<=e.r2;h++)for(l=e.g1;l<=e.g2;l++)g=v(h,l,c),d+=t[g]||0;a+=d,s[c]=a}return s.forEach(function(t,e){f[e]=a-t}),n(u==o?"r":u==r?"g":"b")}},m=function(t,e){function n(t,e){for(var n=1,r=0,i=void 0;r<c;)if(i=t.pop(),i.count()){var u=p(o,i),a=u[0],s=u[1];if(!a)return void console.log("vbox1 not defined; shouldn't happen!");if(t.push(a),s&&(t.push(s),n++),n>=e)return;if(r++>c)return void console.log("infinite loop; perhaps too few pixels!")}else t.push(i),r++}if(!t.length||e<2||e>256)return console.log("wrong number of maxcolors"),!1;var o=d(t),r=0;o.forEach(function(){r++});var i=g(t,o),u=new l(function(t,e){return a["default"].naturalOrder(t.count(),e.count())});u.push(i),n(u,h*e);for(var s=new l(function(t,e){return a["default"].naturalOrder(t.count()*t.volume(),e.count()*e.volume())});u.size();)s.push(u.pop());n(s,e-s.size());for(var f=new _;s.size();)f.push(s.pop());return f},b=function(){function t(e,n,o,i,u,a,s){r(this,t),this.r1=e,this.r2=n,this.g1=o,this.g2=i,this.b1=u,this.b2=a,this.histo=s}return i(t,[{key:"volume",value:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume}},{key:"count",value:function(t){var e=this.histo;if(!this._count_set||t){var n=0,o=void 0,r=void 0,i=void 0;for(o=this.r1;o<=this.r2;o++)for(r=this.g1;r<=this.g2;r++)for(i=this.b1;i<=this.b2;i++){var u=v(o,r,i);n+=e[u]||0}this._count=n,this._count_set=!0}return this._count}},{key:"copy",value:function(){return new t(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)}},{key:"avg",value:function(t){var e=this.histo;if(!this._avg||t){var n=0,o=1<<8-s,r=0,i=0,u=0,a=void 0,f=void 0,c=void 0,h=void 0,l=void 0;for(f=this.r1;f<=this.r2;f++)for(c=this.g1;c<=this.g2;c++)for(h=this.b1;h<=this.b2;h++)l=v(f,c,h),a=e[l]||0,n+=a,r+=a*(f+.5)*o,i+=a*(c+.5)*o,u+=a*(h+.5)*o;n?this._avg=[~~(r/n),~~(i/n),~~(u/n)]:(console.log("empty box"),this._avg=[~~(o*(this.r1+this.r2+1)/2),~~(o*(this.g1+this.g2+1)/2),~~(o*(this.b1+this.b2+1)/2)])}return this._avg}},{key:"contains",value:function(t){var e=t[0]>>f,n=t[1]>>f,o=t[2]>>f;return e>=this.r1&&e<=this.r2&&n>=this.g1&&n<=this.g2&&o>=this.b1&&o<=this.b2}}]),t}(),_=function(){function t(){r(this,t),this.vboxes=new l(function(t,e){return a["default"].naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}return i(t,[{key:"push",value:function(t){this.vboxes.push({vbox:t,color:t.avg()})}},{key:"palette",value:function(){return this.vboxes.map(function(t){return t.color})}},{key:"size",value:function(){return this.vboxes.size()}},{key:"map",value:function(t){for(var e=this.vboxes,n=0;n<e.size();n++)if(e.peek(n).vbox.contains(t))return e.peek(n).color;return this.nearest(t)}},{key:"nearest",value:function(t){for(var e=this.vboxes,n=void 0,o=void 0,r=void 0,i=0;i<e.size();i++)o=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)),(o<n||void 0===n)&&(n=o,r=e.peek(i).color);return r}},{key:"forcebw",value:function(){var t=this.vboxes;t.sort(function(t,e){return a["default"].naturalOrder(a["default"].sum(t.color),a["default"].sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[n].color=[255,255,255])}}]),t}();e["default"]=m,t.exports=e["default"]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),/*!
	 * Block below copied from Protovis: http://mbostock.github.com/protovis/
	 * Copyright 2010 Stanford Visualization Group
	 * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
	 */
e["default"]={map:function(t,e){var n={};return e?t.map(function(t,o){return n.index=o,e.call(n,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var n={};return t.reduce(e?function(t,o,r){return n.index=r,t+e.call(n,o)}:function(t,e){return t+e},0)}},t.exports=e["default"]}])});
//# sourceMappingURL=color-palettes.min.js.map